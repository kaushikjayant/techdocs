# Deploying Common Configuration {#d0e774}

The common configuration will handle :

-   docker secrets in order to access the corporate Docker registry and pull the container images
-   the common properties shared by all delivered software on the production cluster.
-   the binding to the storage resources
-   the license files

**Procedures**

**Docker Secrets**

Make sure that you are connected to the OpenShift cluster on the correct project by executing from your DevOps station :

```
   oc login <cluster_url>
```

```
   oc project <project_name>
```

Then execute the following commands from your DevOps station :

```
   docker login docker.mycom-osi.com
```

Authenticate as : mycomosi / mo-eaa-ecr

```
   docker login docker-fr.mycom-osi.com
```

Authenticate as : mo-deploy / Mycom-ocp-321

```
   oc secrets new docker-secret .dockerconfigjson=$HOME/.docker/config.json
```

**Running privileges**

For this version the running privileges need to be updated for our containers to run.

In order to do this please enter the following command :

```
  oc edit scc restricted
```

Then edit runAsUser section and enter the following content :

```
  runAsUser:
```

```
    type: RunAsAny
```

Save the file and exit , modifications will be propagated.

**Deploy the license file**

Deploy the site lic.cry in the volume \(Ceph or NFS\) declared as **<namespace\>-platform-volume**at licmgr/lic/lic.cry

**Storage Resource Binding**

Run the command:

<root\_git\_dir\>/eaa-deploy/shell/check-pvs.sh <customer-namespace\> to check all the PVs that you will have to create.

You can find a sample of some yaml pv files on this eaa-deploy-site repo: [eaa-deploy-site-rd-eaa-staging](https://gitlab.mycom-osi.com/eaa/eaa-deploy-site-rd-staging/tree/master/pv).

The procedure will be:

-   to create your own pv files eaa-deploy-site-<customer-project\>/pv
-   to check that "*eaa-deploy/shell/check-pvs.sh <customer-project\>"* is returning an empty list of remaining pvs to create

**On a Production cluster**

Create the *eaa-deploy-site-<customer-project\>/pv/ceph-pv.yaml* file for the PVs listed by the previously run command \(check-pvs.sh\).

-   Examples of Ceph binding can be found in the OpenShift documentation under the following pointer [https://docs.openshift.com/enterprise/3.1/install\_config/persistent\_storage/persistent\_storage\_ceph\_rbd.html](https://docs.openshift.com/enterprise/3.1/install_config/persistent_storage/persistent_storage_ceph_rbd.html).
-   The Ceph bindings in this file need to reflect the parameters in order to mount the RDBs on the cluster site. Note that you must not rename any names of the PV and PVCs declared in a file.

Once the update is performed, issue the following commands :

```
     oc apply -f *eaa-deploy-site-<customer-project\>/pv/ceph-pv.yaml*
```

Then add the created files to your DevOps GIT \( git add, commit and push \)

**On a Dev cluster**

Create the *eaa-deploy-site-<customer-project\>/pv/nfs-pv.yaml* file for the PVs listed by the previously run command \(check-pvs.sh\).

Update "config/eaa-nfs-pv.env" with the NFS values relevant for your environment, then execute the following commands :

oc apply -f *eaa-deploy-site-<customer-project\>/pv/nfs-pv.yaml*

