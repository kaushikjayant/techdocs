# Installing ProAssure {#d0e1367}

This script will deploy the all required ProAssure components

-   *ProAssure CMDB*
-   *ProAssure Trouble Ticket Manager*
-   *ProAssure FM*
-   *ProAssure PM*
-   *ProAssure Service Designer*
-   *ProAssure Service Problem Management \(SPM\)*
-   *ProAssure TT*
-   *ProAssure Unit Mapping*
-   *ProAssure Spark Gateway*
-   ProAssure Service Problem Manager Topology Analyzer[1](#fntarg_1)

**Configuration Preparation**

Refer to [Preparing ProAssure Configuration](appendix_pa.md) using the following dryrun cmd:

```
./eaa-proptima/shell/deploy-proptima.sh --dryrun --pristine

```

***Procedure***

Go to <root\_git\_dir\> directory in terminal and execute the following commands

```
./eaa-proptima/shell/deploy-proptima.sh --freshinstall --pristine

./eaa-proptima/shell/deploy-proptima.sh --pristine --proceed
```

**Note:** In order to create the db users / roles and OAuth Json files, Please do the following :

-   Connect to the prepare-db pod \( eaa-proptima-prepare-db-proassure for ProAssure\) using the following command:

    ```
    oc rsh <eaa-proptima-prepare-db-<name>>
    ```

-   Go to the directory /opt/mycom/proptima/proptima-deploy:

    ```
    cd /opt/mycom/proptima/proptima-deploy
    ```

-   Run the following command :

    ```
    ./StartProptimaPrepareDb.sh
    ```


## Configuring Write and Transform Pods { .section}

Perform the following steps after installing NIMS Pristine:

-   Add the following properties in Write proassure pod in the /opt/mycomosi/config/properties-site/Write.site.properties file:

    ```
    FlatFileResizer.AdaptorNames=mycm_base_csv_t1.0.1 2
    ```

-   Add the following property in the Transform ProAssure pod in the /opt/mycom/config/properties-site/Transform.site.properties file:

    ```
    ETL.PARSE.SkipUpdateAnalyticsDatasource.DS.mycm_base_csv_t1.0.1.PM1=true
    ```

-   Restart the Tranform and Write pods.

## Deploying ProAssure { .section}

Go to <root\_git\_dir\> directory in terminal and execute the following commands:

```
./eaa-proassure/shell/deploy-proassure.sh --freshinstall
./eaa-proassure/shell/deploy-proassure.sh --proceed
```

This script will deploy the PrOptima for ProAssure

-   *Authentication Service*
-   *Mediation*
-   *Reporting*
-   *Web-Reporting*
-   *Administration services*

 

**Database Instance Deployment**

**Checks**

Identify the pod running the db deploy by issuing the following command

```
  oc get pods | grep prepare-db-proassure
```

then tail the logs and lookup for the database creation success message with the following command :

oc logs -f <podName\>

**Note :**

In order to create the db users / roles and OAuth Json files, Please do the following :

-   Connect to the prepare-db pod \( eaa-proptima-prepare-db-proassure for ProAssure\) using the following command

    ```
    oc rsh <eaa-proptima-prepare-db-<name>>
    ```

-   Go to the directory /opt/mycom/proptima/proptima-deploy 

    ```
    cd /opt/mycom/proptima/proptima-deploy
    ```

-   Run the following command:

    ```
    ./StartProptimaPrepareDb.sh
    ```


**Note:** If the installation contains the Proptima PM Solution also, then it is recommended to have a single Oauth and Single welcome page for the PM and Pristine NIMS for ProAssure.

Inorder to have a single Oauth Server, Please do the following :

-   Connect to the prepare-db pod \( eaa-proptima-prepare-db-proassure for ProAssure\) using the following command:

    ```
    oc rsh <eaa-proptima-prepare-db-<name>>
    ```

-   Go to the directory /opt/mycom/proptima/proptima-deploy:

    ```
    cd /opt/mycom/proptima/proptima-deploy
    ```

-   Run the following command:

    ```
    ./ConfigureOAuth.sh
    ```


****Configuring Proassure Proptima Extract process****

To download the PM/FM csv files, please do the following configuration in Extract process

-   Extract the pv path

    ```
    oc describe pv eaa-staging-proptima-proassure-volume | grep Path | awk -F':' '{print $2}'
    oc describe pv eaa-staging-proptima-proassure-volume | grep Path | awk -F':' '{print $2}'
    ```

    It will show the directory path e.g. /srv/nfs/volumes\_eaa\_staging/proassure-proptima

-   Go to directory <PV\_Path\>: /config/properties-site/ 
-   Create FtpMediation.site.properties file e.g. /srv/nfs/volumes\_eaa\_staging/proassure-proptima/config/properties-site/FtpMediation.site.properties:
-   Add the following content in the file, Please update the analytics name:

    **Note:** In case of upgrade please update the site.properties mentioned below \(pay extra care to SourceXXX.SourceDir\).

    ```
    ########################################## 
    ### PM-VALVE collection measurement # 
    ##########################################
     
     
    Source191.IP=eaa-platform-ftp-server
    Source191.Login=mycomosi
    Source191.Password=2b1c1e161201241c0c0e2b262533
    Source191.SourceDir=/opt/mycomosi/pi/PM/
    Source191.DestDir=/opt/mycom/data/mycom/base/csv_t1.0.1/pm1
    Source191.SubDir.1=.
    Source191.UseSftp=true
    Source191.AnalyticsName=MYCOMOSI
     
    ########################################## 
    ### FM-VALVE collection measurement # 
    ########################################## 
     
    Source192.IP=eaa-platform-ftp-server
    Source192.Login=mycomosi
    Source192.Password=2b1c1e161201241c0c0e2b262533
    Source192.SourceDir=/opt/mycomosi/pi/FM/ProptimaWebDesigner
    Source192.DestDir=/opt/mycom/data/mycom/base/csv_t1.0.1/pm1
    Source192.SubDir.1=.
    Source192.UseSftp=true
    Source192.AnalyticsName=MYCOMOSI
     
           
     
    ##########################################
    ### TT-BRIDGE collection measurement #
    ##########################################
     
     
    Source193.IP=eaa-platform-ftp-server
    Source193.Login=mycomosi
    Source193.Password=2b1c1e161201241c0c0e2b262533
    Source193.SourceDir=/opt/mycomosi/pi/TT/ProptimaWebDesigner
    Source193.DestDir=/opt/mycom/data/mycom/base/csv_t1.0.1/pm1
    Source193.SubDir.1=.
    Source193.UseSftp=true
    Source193.AnalyticsName=MYCOMOSI
    
    
    ##########################################
    ### SPM-BRIDGE collection measurement #
    ##########################################
    Source194.IP=eaa-platform-ftp-server
    Source194.Login=mycomosi
    Source194.Password=2b1c1e161201241c0c0e2b262533
    Source194.SourceDir=/opt/mycomosi/pi/SPM/ServiceDesigner/
    Source194.DestDir=/opt/mycom/data/mycom/base/csv_t1.0.1/pm1
    Source194.SubDir.1=.
    Source194.UseSftp=true
    Source194.AnalyticsName=MYCOMOSI
    ```

-   Restart the eaa-proptima-extract-proassure pod, to get the pod detail -

```
oc get pods | grep eaa-proptima-extract-proassure
eaa-proptima-extract-proassure-11-5nc76 3/3 Running 1 21h
```

 

To enable the PM-Valve to access PrOptima you need to connect to the eaa-platform-oauth2-pm Pod and create following files:

/opt/mycomosi/data/oauth2\_json\_rootpath/client-details/pm-valve.json

```
{
 "client_id":"pm-valve",
 "client_secret":"$2a$10$wDyIoek0KjWvAFzpI6Uf/uiGxLd8qfnddjWoKosI2MydWCYSvUt9i",
 "authorized_grant_types":["client_credentials"],
 "authorities":["ROLE_CLIENT","ROLE_DATA_STREAMING","ROLE_ADMIN_DEPLOY","ROLE_WEB_DASHBOARD"]
}
```

 /opt/mycomosi/data/oauth2\_json\_rootpath/resource-server-details/pm-valve.json

```
{ "account_non_expired":true,"account_non_locked":true,
"credentials_non_expired":true,"enabled":true,
 "resource_server_name":"pm-valve",
 "password":"$2a$10$wDyIoek0KjWvAFzpI6Uf/uiGxLd8qfnddjWoKosI2MydWCYSvUt9i",
 "authorities":["ROLE_CLIENT"]
}
```

## Setting MAX Result Window Setting { .section}

After installing ProAssure, you must set the max\_result\_window value in elastic index to enable working with a large data set. For example:

```
PUT cmdb/_settings

{ "max_result_window" : 2147483647 }
PUT servicdesigner/_settings

{ "max_result_window" : 2147483647 }
PUT fmingestion/_settings

{ "max_result_window" : 2147483647 }
```

**Configuring Threshold Crossing Alarms \(TCA\) for PA-NIMS**

You must make the following changes to ensure that TCA alarms are sent to PA-NIMS:

-   Go to the fm-valve pod.
-   Navigate to /opt/mycomosi/data/fm-bridge/config/connector inside fm-valve and create a TMF524.json file with contents:

    ```
    { 
       "id":"TMF524",
       "source":"TMF524",
       "mode":"PULL",
       "alarmCollectionRequestTopicName":"tmfreqtopic",
       "alarmCollectionResponseTopicName":"tmfrestopic",
       "alarmSubscriptionTopicName":"alarm-subscription-tmf524",
       "cronScheduleExpression":"0 0/5*1/1* ? *"
    }
    ```

-   Open eaa-proptima-alarm-engine-proassure pod and navigate to path /opt/mycom/config/server/res and create AlarmEngine.site.properties file with following contents if not created earlier:

    ```
    ALRM.SNMP.ActivateAgent=false
     
    ALRM.SNMP.GetRequestUdpPort=1050
    Alarm.ConditionRule=AutoCleared
    Alarm.AERMemoryCacheDayHistory=3650
    COM.MDDSCNX.MddsContextDuration.AlarmProcessor=3650
    ALRM.EVAL.ReliabilityRatio=0.75
    AlarmPurge.DayCount=365
    log4j.logger.nims.alarm.engine=DEBUG
    log4j.logger.ALARM=DEBUG
    Alarm.AERMemoryCacheDayHistory=10000
     
    ALRM.EVAL.ReliabilityRatio=0.2
     
    # We want to keep the last 2 days of alarm results only:
    AlarmPurge.DayCount=1
     
    #Alarm Source
    Alarm.Source.Name=PA-NIMS
    ```

-   Save the above properties and restart the pod.

**Launching Service Impact and Service Problem spark applications**

In order to launch service impact and service problem spark applications, you have to follow the procedure:

-   ```
oc rsh <spark-app-gateway pod>
```

-   In order to retrieve the spark-app-gateway pod, you can run the following "oc get pods | grep spark-app-gateway"
-   when connected:
    -   ```
cd /opt/mycomosi/shell
```

    -   ```
./launch-service-impact.sh
```

    -   ```
./launch-problem-management.sh
```


You can then check in the spark-ui-proxy that your application are correctly launched.

In order to retrieve the URL of the spark-ui-proxy, you can run the following command:

```
oc get route | grep spark | awk '{print $2}
```

**Launching Service Problem Manager UI \(SPM UI\)**

In order to launch Service Problem Manager, follow these procedures:

**Get SPM UI pod list:**

In order to retrieve SPM UI pod list, run the following command:

```
oc get pods | grep eaa-pa-spm
```

This should list two related modules:

1. eaa-pa-spm-ingestion

2. eaa-pa-spm-query

Run the following command:

```
oc get pods | grep eaa-pa-problem-manager
```

This should list one related module: eaa-pa-problem-manager

You can then check whether application is up and running by launching the SPM UI URL.

In order to retrieve SPM UI, you can run the following command:

```
oc get route | grep eaa-pa-problem | awk '{print $2}'
```

## Verifying licmanager Pod Deployment { .section}

Verify that the licmanager pod is deployed as follows:

-   Verify that the licmanager pod is deployed by running the following command:

    ```
    oc get pods | grep eaa-nx-licmgr
    ```

    This should list one module:

    ```
    eaa-nx-licmgr
    ```

-   Once verified that the licmanager pod is deployed, restart the eaa-pa-problem-manager pod.

## Creating PA-SPM Configuration File { .section}

Perform the following steps to add configuration file for PA-SPM UI:

-   Go to ProAssure PVC NFS location. It is as follows:

    ```
    <nfs location>/<oc project location>/proassure
    ```

-   Create a new location under /proassure:

    ```
    spm/problem-manager/config
    ```

-   Create config.jsonwith following content under /config directory:

    ```
    {  
       "ttOriginatorDisplayConfig":{  
          "values":[  
             "Service Assurance"
          ],
          "displayValue":"Proassure",
          "defaultDisplayValue":"Non Proassure"
       }
    }
    ```


[1](#fnsrc_1) After installing ProAssure, you must separately configure ProAssure-Service Problem Manager \(PA-SPM\) to enable launching Topology Analyzer from PA-SPM. Refer to the Configuring ProAssure Service Problem Manager to Launch Topology Analyzer section of the ProAssure Service Problem Manager Configuration Guide for detailed procedure.

